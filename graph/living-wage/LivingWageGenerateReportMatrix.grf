<?xml version="1.0" encoding="UTF-8"?><Graph author="hankmobley" created="Fri Sep 23 09:41:37 EDT 2016" description="This graph will create all the data necessary for generating living wage reports." guiVersion="3.4.4.P" id="1474644206703" licenseType="Commercial" modified="Thu Oct 13 16:50:06 EDT 2016" modifiedBy="hankmobley" name="LivingWageGenerateReportMatrix" revision="1.17" showComponentDetails="true">
<Global>
<Metadata id="Metadata1" previewAttachmentCharset="ISO-8859-1">
<Record fieldDelimiter="|" name="SQLUpdate" previewAttachmentCharset="ISO-8859-1" recordDelimiter="\n" type="delimited">
<Field name="sql" type="string"/>
</Record>
</Metadata>
<Connection database="DSS" dbURL="jdbc:dss://secure.gooddata.com/gdc/dss/instances/d68eb234fff8f2750cbf7dd02b20fd0e" id="JDBC0" jdbcSpecific="DSS" name="GOODDATA_DEV" password="justcapital1!" type="JDBC" user="ps-etl+justcapital_research@gooddata.com"/>
<Property id="GraphParameter0" name="COLUMN_NUMBERS_TABLENAME" value="TMP_LIVING_WAGE_REPORT_COLUMN_NUMBERS"/>
<Property fileURL="workspace.prm" id="GraphParameter1"/>
<Dictionary/>
</Global>
<Phase number="0">
<Node enabled="enabled" guiName="Add Active Companies" guiX="25" guiY="190" id="ADD_ACTIVE_COMPANIES" type="DB_EXECUTE"/>
<Node enabled="enabled" guiName="Add Alt Company Names" guiX="341" guiY="382" id="ADD_ALT_COMPANY_NAMES" type="DB_EXECUTE"/>
<Node enabled="enabled" guiName="Add Col Count Data" guiX="419" guiY="857" id="ADD_COL_COUNT_DATA" type="DB_EXECUTE"/>
<Node enabled="enabled" guiName="Add Co Header Blank Top" guiX="57" guiY="1136" id="ADD_CO_HEADER_BLANK_TOP" type="DB_EXECUTE"/>
<Node enabled="enabled" guiName="Add FIPS-PP Map Data" guiX="503" guiY="190" id="ADD_FIPS_PP_MAP_DATA" type="DB_EXECUTE"/>
<Node enabled="enabled" guiName="Add Ind Header Blank Bottom 1" guiX="146" guiY="1025" id="ADD_IND_HEADER_BLANK_BOTTOM_1" type="DB_EXECUTE"/>
<Node enabled="enabled" guiName="Add Ind Header Blank Bottom 2" guiX="368" guiY="1025" id="ADD_IND_HEADER_BLANK_BOTTOM_2" type="DB_EXECUTE"/>
<Node enabled="enabled" guiName="Add Ind Header Blank Top" guiX="182" guiY="951" id="ADD_IND_HEADER_BLANK_TOP" type="DB_EXECUTE"/>
<Node enabled="enabled" guiName="Add Ind Header Name" guiX="368" guiY="951" id="ADD_IND_HEADER_NAME" type="DB_EXECUTE"/>
<Node enabled="enabled" guiName="Add Job County Data" guiX="114" guiY="857" id="ADD_JOB_COUNTY_DATA" type="DB_EXECUTE"/>
<Node enabled="enabled" guiName="Add Job Order Data" guiX="271" guiY="857" id="ADD_JOB_ORDER_DATA" type="DB_EXECUTE"/>
<Node enabled="enabled" guiName="Add Living Wage Avgs" guiX="175" guiY="267" id="ADD_LIVING_WAGE_AVGS" type="DB_EXECUTE"/>
<Node enabled="enabled" guiName="Add Matrix Types" guiX="338" guiY="267" id="ADD_MATRIX_TYPES" type="DB_EXECUTE"/>
<Node enabled="enabled" guiName="Add Missing Subsidiay Data" guiX="250" guiY="452" id="ADD_MISSING_SUBSIDIAY_DATA1" type="DB_EXECUTE"/>
<Node enabled="enabled" guiName="Add Subsidiary Blank Top" guiX="32" guiY="1318" id="ADD_SUBSIDIARY_BLANK_TOP" type="DB_EXECUTE"/>
<Node enabled="enabled" guiName="Add Subsidiary Data" guiX="176" guiY="1395" id="ADD_SUBSIDIARY_DATA" type="DB_EXECUTE"/>
<Node enabled="enabled" guiName="Add Subsidiary GOC Headers" guiX="474" guiY="1318" id="ADD_SUBSIDIARY_GOC_HEADERS" type="DB_EXECUTE"/>
<Node enabled="enabled" guiName="Add Subsidiary Info" guiX="187" guiY="190" id="ADD_SUBSIDIARY_INFO" type="DB_EXECUTE"/>
<Node enabled="enabled" guiName="Add Subsidiary Name and Dist Headers" guiX="218" guiY="1318" id="ADD_SUBSIDIARY_NAME_AND_DIST_HEADERS" type="DB_EXECUTE"/>
<Node enabled="enabled" guiName="Add Subsidiary Totals" guiX="329" guiY="1395" id="ADD_SUBSIDIARY_TOTALS" type="DB_EXECUTE"/>
<Node enabled="enabled" guiName="Add Ticker Data" guiX="203" guiY="1213" id="ADD_TICKER_DATA" type="DB_EXECUTE"/>
<Node enabled="enabled" guiName="Add Ticker GOC Headers" guiX="480" guiY="1136" id="ADD_TICKER_GOC_HEADERS" type="DB_EXECUTE"/>
<Node enabled="enabled" guiName="Add Ticker Name and Dist Headers" guiX="246" guiY="1136" id="ADD_TICKER_NAME_AND_DIST_HEADERS" type="DB_EXECUTE"/>
<Node enabled="enabled" guiName="Add Ticker Totals" guiX="350" guiY="1213" id="ADD_TICKER_TOTALS" type="DB_EXECUTE"/>
<Node enabled="enabled" guiName="Cleanup DIst and County Data" guiX="243" guiY="748" id="CLEANUP_DIST_AND_COUNTY_DATA" type="DB_EXECUTE"/>
<Node enabled="enabled" guiName="Clean up Companies with subsidiaries" guiX="222" guiY="597" id="CLEAN_UP_COMPANIES_WITH_SUBSIDIARIES" type="DB_EXECUTE"/>
<Node enabled="enabled" guiName="Clean up County Counts" guiX="331" guiY="190" id="CLEAN_UP_COUNTY_COUNTS" type="DB_EXECUTE"/>
<Node enabled="enabled" guiName="Clean up no-subsidiary Companies" guiX="230" guiY="523" id="CLEAN_UP_NO_SUBSIDIARY_COMPANIES" type="DB_EXECUTE"/>
<Node enabled="enabled" guiName="Create Parent County Counts" guiX="243" guiY="670" id="CREATE_PARENT_COUNTY_COUNTS" type="DB_EXECUTE"/>
<Node enabled="enabled" guiName="Create Update Dist Header SQL" guiX="207" guiY="1517" id="CREATE_UPDATE_DIST_HEADER_SQL" type="REFORMAT">
<attr name="transform"><![CDATA[//#CTL2

// Transforms input record into output record.
function integer transform() {
	string sql = "";
	sql = sql + "update LKP_LIVING_WAGE_REPORT_MATRIX mtx ";
	sql = sql + "set g" + $in.0.column_name + " = d.distribution";
	sql = sql + "from TMP_LIVING_WAGE_GOC_ORDER g";
	sql = sql + "join lkp_just_co_secty_master m on m.just_co_id = g.just_co_id";
	sql = sql + "join LKP_LIVING_WAGE_SUBSIDIARY_INFO s on s.just_co_id = m.just_co_id";
	sql = sql + "join lkp_living_wage_goc_distributions d on d.ticker = m.ticker_trim and d.goc = g.goc and d.subsidiary = g.subsidiary";
	sql = sql + "where (not s.has_subsidiaries) and g.just_co_id = mtx.just_co_id and mtx.row_type = 'CO_TICKER_NAME_COUNT_DIST_COLOMUN_HEADERS'";
  	sql = sql + "and g.goc_column_no = " + $in.0.column_name + ";";
	
	$out.0.sql = sql;

	return ALL;
}

// Called during component initialization.
// function boolean init() {}

// Called during each graph run before the transform is executed. May be used to allocate and initialize resources
// required by the transform. All resources allocated within this method should be released
// by the postExecute() method.
// function void preExecute() {}

// Called only if transform() throws an exception.
// function integer transformOnError(string errorMessage, string stackTrace) {}

// Called during each graph run after the entire transform was executed. Should be used to free any resources
// allocated within the preExecute() method.
// function void postExecute() {}

// Called to return a user-defined error message when an error occurs.
// function string getMessage() {}
]]></attr>
</Node>
<Node enabled="enabled" guiName="Create Update Subsidiary Data SQL" guiX="197" guiY="1956" id="CREATE_UPDATE_SUBSIDIARY_DATA_SQL" type="REFORMAT"/>
<Node enabled="enabled" guiName="Create Update Subsidiary Dist Headers SQL" guiX="171" guiY="1807" id="CREATE_UPDATE_SUBSIDIARY_DIST_HEADERS_SQL" type="REFORMAT"/>
<Node enabled="enabled" guiName="Create Update Subsidiary GOC Headers SQL" guiX="172" guiY="1883" id="CREATE_UPDATE_SUBSIDIARY_GOC_HEADERS_SQL" type="REFORMAT"/>
<Node enabled="enabled" guiName="Create Update Ticker Data SQL" guiX="208" guiY="1738" id="CREATE_UPDATE_TICKER_DATA_SQL" type="REFORMAT"/>
<Node enabled="enabled" guiName="Create Update Ticker (no subs) GOC Header SQL" guiX="157" guiY="1591" id="CREATE_UPDATE_TICKER_NO_SUBS_GOC_HEADER_SQL" type="REFORMAT"/>
<Node enabled="enabled" guiName="Create Update Ticker (subs) GOC Header SQL" guiX="168" guiY="1662" id="CREATE_UPDATE_TICKER_SUBS_GOC_HEADER_SQL" type="REFORMAT">
<attr name="transform"><![CDATA[//#CTL2

// Transforms input record into output record.
function integer transform() {
	string sql = "";
	sql = sql + "update LKP_LIVING_WAGE_REPORT_MATRIX mtx ";
	sql = sql + "set g" + $in.0.column_name + " = d.distribution";
	sql = sql + "from TMP_LIVING_WAGE_GOC_ORDER g";
	sql = sql + "join lkp_just_co_secty_master m on m.just_co_id = g.just_co_id";
	sql = sql + "join LKP_LIVING_WAGE_SUBSIDIARY_INFO s on s.just_co_id = m.just_co_id";
	sql = sql + "join lkp_living_wage_goc_distributions d on d.ticker = m.ticker_trim and d.goc = g.goc and d.subsidiary = g.subsidiary";
	sql = sql + "where (not s.has_subsidiaries) and g.just_co_id = mtx.just_co_id and mtx.row_type = 'CO_TICKER_NAME_COUNT_DIST_COLOMUN_HEADERS'";
  	sql = sql + "and g.goc_column_no = " + $in.0.column_name + ";";
	
	$out.0.sql = sql;

	return ALL;
}

// Called during component initialization.
// function boolean init() {}

// Called during each graph run before the transform is executed. May be used to allocate and initialize resources
// required by the transform. All resources allocated within this method should be released
// by the postExecute() method.
// function void preExecute() {}

// Called only if transform() throws an exception.
// function integer transformOnError(string errorMessage, string stackTrace) {}

// Called during each graph run after the entire transform was executed. Should be used to free any resources
// allocated within the preExecute() method.
// function void postExecute() {}

// Called to return a user-defined error message when an error occurs.
// function string getMessage() {}
]]></attr>
</Node>
<Node enabled="enabled" guiName="Drop Temp Col Count Table" guiX="368" guiY="2068" id="DROP_TEMP_COL_COUNT_TABLE" type="DB_EXECUTE"/>
<Node enabled="enabled" guiName="Drop Temp GOC Order Table" guiX="165" guiY="2068" id="DROP_TEMP_GOC_ORDER_TABLE" type="DB_EXECUTE"/>
<Node dbConnection="JDBC0" enabled="enabled" guiName="Read Columns" guiX="-15" guiY="1726" id="READ_COLUMNS" type="DB_INPUT_TABLE">
<attr name="sqlQuery"><![CDATA[select $Column_Number:=column_number
from ${COLUMN_NUMBERS_TABLENAME};]]></attr>
</Node>
<Node enabled="enabled" guiName="Remove Non-Active" guiX="189" guiY="382" id="REMOVE_NON_ACTIVE" type="DB_EXECUTE"/>
<Node enabled="enabled" guiName="Table: Active Companies" guiX="166" guiY="10" id="TABLE_ACTIVE_COMPANIES" type="DB_EXECUTE"/>
<Node dbConnection="JDBC0" enabled="enabled" guiName="Table: FIPS-PP Map" guiX="338" guiY="10" id="TABLE_FIPS_PP_MAP" type="DB_EXECUTE"/>
<Node enabled="enabled" guiName="Table: Job Data" guiX="-31" guiY="82" id="TABLE_JOB_DATA" type="DB_EXECUTE"/>
<Node dbConnection="JDBC0" enabled="enabled" guiName="Table: Living Wage Avg" guiX="490" guiY="10" id="TABLE_LIVING_WAGE_AVG" type="DB_EXECUTE"/>
<Node enabled="enabled" guiName="Table: Report Matrix" guiX="412" guiY="82" id="TABLE_REPORT_MATRIX" type="DB_EXECUTE"/>
<Node enabled="enabled" guiName="Table: Row Type" guiX="106" guiY="82" id="TABLE_ROW_TYPE" type="DB_EXECUTE"/>
<Node enabled="enabled" guiName="Table: Subsidiary Info" guiX="0" guiY="10" id="TABLE_SUBSIDIARY_INFO" type="DB_EXECUTE"/>
<Node enabled="enabled" guiName="Table: Temp Col Count" guiX="561" guiY="82" id="TABLE_TEMP_COL_COUNT" type="DB_EXECUTE"/>
<Node enabled="enabled" guiName="Table: Temp GOC Order" guiX="243" guiY="82" id="TABLE_TEMP_GOC_ORDER" type="DB_EXECUTE"/>
<Node enabled="enabled" guiName="Update Subsidiary Data" guiX="514" guiY="1956" id="UPDATE_SUBSIDIARY_DATA" type="DB_EXECUTE"/>
<Node enabled="enabled" guiName="Update Subsidiary Dist Headers" guiX="491" guiY="1807" id="UPDATE_SUBSIDIARY_DIST_HEADERS" type="DB_EXECUTE"/>
<Node enabled="enabled" guiName="Update Subsidiary GOC Headers" guiX="489" guiY="1883" id="UPDATE_SUBSIDIARY_GOC_HEADERS" type="DB_EXECUTE"/>
<Node enabled="enabled" guiName="Update Ticker Data" guiX="521" guiY="1738" id="UPDATE_TICKER_DATA" type="DB_EXECUTE"/>
<Node dbConnection="JDBC0" enabled="enabled" guiName="Update Ticker Dist Headers" guiX="491" guiY="1517" id="UPDATE_TICKER_DIST_HEADERS" type="DB_EXECUTE" url="port:$0.sql:discrete"/>
<Node enabled="enabled" guiName="Update Ticker (no subs) GOC Headers" guiX="474" guiY="1591" id="UPDATE_TICKER_NO_SUBS_GOC_HEADERS" type="DB_EXECUTE"/>
<Node dbConnection="JDBC0" enabled="enabled" guiName="Update Ticker (subs) GOC Headers" guiX="482" guiY="1662" id="UPDATE_TICKER_SUBS_GOC_HEADERS" type="DB_EXECUTE" url="port:$0.sql:discrete"/>
<Edge fromNode="CREATE_UPDATE_DIST_HEADER_SQL:0" guiBendpoints="" guiRouter="Manhattan" id="Edge1" inPort="Port 0 (input parameters)" metadata="Metadata1" outPort="Port 0 (out)" toNode="UPDATE_TICKER_DIST_HEADERS:0"/>
<Edge fromNode="CREATE_UPDATE_SUBSIDIARY_DATA_SQL:0" guiBendpoints="" guiRouter="Manhattan" id="Edge13" inPort="Port 0 (input parameters)" metadata="Metadata1" outPort="Port 0 (out)" toNode="UPDATE_SUBSIDIARY_DATA:0"/>
<Edge fromNode="CREATE_UPDATE_SUBSIDIARY_DIST_HEADERS_SQL:0" guiBendpoints="" guiRouter="Manhattan" id="Edge9" inPort="Port 0 (input parameters)" metadata="Metadata1" outPort="Port 0 (out)" toNode="UPDATE_SUBSIDIARY_DIST_HEADERS:0"/>
<Edge fromNode="CREATE_UPDATE_SUBSIDIARY_GOC_HEADERS_SQL:0" guiBendpoints="" guiRouter="Manhattan" id="Edge11" inPort="Port 0 (input parameters)" metadata="Metadata1" outPort="Port 0 (out)" toNode="UPDATE_SUBSIDIARY_GOC_HEADERS:0"/>
<Edge fromNode="CREATE_UPDATE_TICKER_DATA_SQL:0" guiBendpoints="" guiRouter="Manhattan" id="Edge8" inPort="Port 0 (input parameters)" metadata="Metadata1" outPort="Port 0 (out)" toNode="UPDATE_TICKER_DATA:0"/>
<Edge fromNode="CREATE_UPDATE_TICKER_NO_SUBS_GOC_HEADER_SQL:0" guiBendpoints="" guiRouter="Manhattan" id="Edge7" inPort="Port 0 (input parameters)" metadata="Metadata1" outPort="Port 0 (out)" toNode="UPDATE_TICKER_NO_SUBS_GOC_HEADERS:0"/>
<Edge fromNode="CREATE_UPDATE_TICKER_SUBS_GOC_HEADER_SQL:0" guiBendpoints="" guiRouter="Manhattan" id="Edge3" inPort="Port 0 (input parameters)" metadata="Metadata1" outPort="Port 0 (out)" toNode="UPDATE_TICKER_SUBS_GOC_HEADERS:0"/>
<Edge fromNode="READ_COLUMNS:0" guiBendpoints="" guiRouter="Manhattan" id="Edge0" inPort="Port 0 (in)" metadata="Metadata1" outPort="Port 0 (out)" toNode="CREATE_UPDATE_DIST_HEADER_SQL:0"/>
<Edge fromNode="READ_COLUMNS:1" guiBendpoints="" guiRouter="Manhattan" id="Edge4" inPort="Port 0 (in)" metadata="Metadata1" outPort="Port 1 (out)" toNode="CREATE_UPDATE_TICKER_NO_SUBS_GOC_HEADER_SQL:0"/>
<Edge fromNode="READ_COLUMNS:2" guiBendpoints="" guiRouter="Manhattan" id="Edge5" inPort="Port 0 (in)" metadata="Metadata1" outPort="Port 2 (out)" toNode="CREATE_UPDATE_TICKER_SUBS_GOC_HEADER_SQL:0"/>
<Edge fromNode="READ_COLUMNS:3" guiBendpoints="" guiRouter="Manhattan" id="Edge6" inPort="Port 0 (in)" metadata="Metadata1" outPort="Port 3 (out)" toNode="CREATE_UPDATE_TICKER_DATA_SQL:0"/>
<Edge fromNode="READ_COLUMNS:4" guiBendpoints="" guiRouter="Manhattan" id="Edge2" inPort="Port 0 (in)" metadata="Metadata1" outPort="Port 4 (out)" toNode="CREATE_UPDATE_SUBSIDIARY_DIST_HEADERS_SQL:0"/>
<Edge fromNode="READ_COLUMNS:5" guiBendpoints="" guiRouter="Manhattan" id="Edge10" inPort="Port 0 (in)" metadata="Metadata1" outPort="Port 5 (out)" toNode="CREATE_UPDATE_SUBSIDIARY_GOC_HEADERS_SQL:0"/>
<Edge fromNode="READ_COLUMNS:6" guiBendpoints="" guiRouter="Manhattan" id="Edge12" inPort="Port 0 (in)" metadata="Metadata1" outPort="Port 6 (out)" toNode="CREATE_UPDATE_SUBSIDIARY_DATA_SQL:0"/>
</Phase>
</Graph>
